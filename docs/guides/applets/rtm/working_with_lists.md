#Work with Lists of Data

##Get a database reference

To read or write data from the database, you need an instance of formelo.database.Reference
```js+lineNumbers:true
    // Get a reference to the database service
    var database = formelo.database();
```
##Reading and writing lists

###Append to a list of data
Use the push() method to append data to a list in multiuser applications. The push() method generates a unique key every time a new child is added to the specified Formelo reference. By using these auto-generated keys for each new element in the list, several clients can add children to the same location at the same time without write conflicts. The unique key generated by push() is based on a timestamp, so list items are automatically ordered chronologically.

You can use the reference to the new data returned by the push() method to get the value of the child's auto-generated key or set data for the child. The .key property of a push() reference contains the auto-generated key.

```js+lineNumbers:true 
// Create a new post reference with an auto-generated id
var newPostRef = postListRef.push();
newPostRef.set({
    // ...
});
```

###Listen for value events
While listening for child events is the recommended way to read lists of data, there are situations listening for value events on a list reference is useful.

Attaching a value observer to a list of data will return the entire list of data as a single snapshot which you can then loop over to access individual children.

Even when there is only a single match for the query, the snapshot is still a list; it just contains a single item. To access the item, you need to loop over the result:

```js+lineNumbers:true 
ref.once('value', function(snapshot) {
  snapshot.forEach(function(childSnapshot) {
    var childKey = childSnapshot.key;
    var childData = childSnapshot.val();
    // ...
  });
});
```

This pattern can be useful when you want to fetch all children of a list in a single operation, rather than listening for additional child added events.

##Sorting and filtering data
You can use the Realtime Database Query class to retrieve data sorted by key, by value, or by value of a child. You can also filter the sorted result to a specific number of results or a range of keys or values.

###Sort data
To retrieve sorted data, start by specifying one of the order-by methods to determine how results are ordered:

| Method        | Usage           |   |
| ------------- |:-------------:|: -----|
| orderByKey()     | Order results by child keys. |  |
| orderByValue()     | Order results by child values. |  |

You can only use one order-by method at a time. Calling an order-by method multiple times in the same query throws an error.

The following example demonstrates how you could retrieve a list of a user's top posts sorted by their star count:

```js+lineNumbers:true 
var myUserId = formelo.auth().currentUser.uid;
var topUserPostsRef = formelo.database().ref('user-posts/' + myUserId).orderByChild('starCount');
```

###Filtering data
To filter data, you can combine any of the limit or range methods with an order-by method when constructing a query

| Method        | Usage           |   |
| ------------- |:-------------:|: -----|
| limitToFirst()     | Order results by child keys. |  |
| limitToLast()     | Sets the maximum number of items to return from the end of the ordered list of results. |  |
| startAt()     | Return items greater than or equal to the specified key or value, depending on the order-by method chosen. |  |
| endAt()     | Return items less than or equal to the specified key or value, depending on the order-by method chosen. |  |
| equalTo()     | Return items equal to the specified key or value, depending on the order-by method chosen. |  |

###Limit the number of results

You can use the limitToFirst() and limitToLast() methods to set a maximum number of children to be synced for a given event. For example, if you use limitToFirst() to set a limit of 100, you initially only receive up to 100 child_added events. If you have fewer than 100 items stored in your Formelo database, a child_added event fires for each item.

As items change, you receive child_added events for items that enter the query and child_removed events for items that drop out of it so that the total number stays at 100.

The following example demonstrates how example blogging app defines a query to retrieve a list of the 100 most recent posts by all users:

```js+lineNumbers:true 
var recentPostsRef = formelo.database().ref('posts').limitToLast(100);
```

This example only defines a query, to actually synchronize data it needs to have an attached listener.